<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://unpkg.com/rxjs@%5E7/dist/bundles/rxjs.umd.min.js"></script>

    <script type="text/javascript">
        const { Observable, fromEvent, map } = rxjs;
    
        function reverseString(str) {
          return str.split("").reverse().join("");
        }
    
        window.onload = function () {
    
          const input = document.getElementById('entrada');
          const output = document.getElementById('salida');
    
    
          const miObservable = new Observable((observable) => {
    
            let salida;
    
            input.addEventListener('input', (e) => {
              console.log(e)
              // if (input.value == 'error')
              //   observable.error('Ingresaron Error');
    
              // if (input.value == 'complete')
              //   observable.complete()
    
              // if (e.data == null) {
              //   salida = output.value.substring(1)
              // }
              // else {
              //   salida = reverseString(output.value);
              //   salida += e.data;
              //   salida = reverseString(salida)
              // }

              if (!e){
                salida += e.data;
              }
    
              observable.next(salida)
            })
          })
    
          const miFuncionNext = (data) => {
            output.value = data;
          }
    
          const miFuncionComplete = () => {
            console.log(`COMPLETE`);
            input.disabled = true;
            input.value = '';
            output.value = '';
            sub.unsubscribe();
          }
    
          const miFuncionError = (msg) => {
            console.log(`ERROR ===> ${msg}`);
            input.disabled = true;
            input.value = '';
            output.value = '';
            sub.unsubscribe();
          }
    
          const handler = {
            next: miFuncionNext,
            error: miFuncionError,
            complete: miFuncionComplete,
          }
          miObservable
            .pipe(
                map((data) => {
                if (input.value == 'error')
                observable.error('Ingresaron Error');
    
                if (input.value == 'complete')
                  observable.complete()
      
                if (e.data == null) {
                  salida = output.value.substring(1)
                }
                else {
                  salida = reverseString(output.value);
                 // salida += e.data;
                  salida = reverseString(salida)
                }                 
                }),
                //filter((data) => data > 30)
            )
            .subscribe(handler);

    
          //const sub = miCustomObservable.subscribe(handler)
          
          setTimeout(() => {
            input.disabled = true;
            input.value = '';
            output.value = '';           
            sub.unsubscribe();
          }, 30000)
    
        }
      </script>
    <title>Document</title>

</head>
<body>
    <input type="text" value="" id="entrada">
    <br />
    <input type="text" value="" id="salida">
</body>
</html>